# 마이그레이션 가이드

## 개요

현재 운영중인 DB의 데이터를 보존한 채 새로운 schema를 적용하여 배포하는 방법에 대해 설명합니다.

## 시작하기에 앞서

데이터베이스는 MySQL 8, 스케마 이름은 `cafeteria`입니다.

로컬 환경에 개발용 DB가 있다고 가정합니다. 이 DB는 `potados@localhost:1234`로 접근할 수 있어야 합니다.

이 저장소에는 운영 DB에 접근하기 위한 인증 정보가 포함되어 있지 않습니다. 다음 세 개의 환경변수를 설정해 주어야 합니다:

- `PROD_DB_HOST`
- `PROD_DB_USERNAME`
- `PROD_DB_PASSWORD`

## 운영 DB 데이터를 확보하여 변환을 거친 뒤 개발 DB에 집어넣기

다음 명령을 실행하면 운영 DB의 모든 데이터를 가져와 적절한 변환을 거쳐 엔티티를 생성한 뒤 개발 DB에 저장합니다.

```bash
$ npm run migration
```

## 개발 DB의 내용을 운영 DB에 덮어쓰기

다음 명령을 실행하면 개발 DB의 모든 데이터와 스케마를 운영 DB에 그대로 덮어씁니다.

```bash
$ cd migration
$ ./sync-db -f local.dev -t aws.prod
```

## 마이그레이션 내역

### 2021.08.21

- TypeORM 도입과 함께 엔티티 연관 관계 수정.
- 예약 기능을 위한 테이블 추가 및 수정.
